# 在线加密文件解密SAAS平台 - 项目总体设计文档

## 1. 文档说明

### 1.1 文档目的
本文档描述在线加密文件解密SAAS平台的整体设计方案，包括系统架构、技术选型、模块划分、部署架构等内容，为项目开发提供总体指导。

### 1.2 适用范围
本文档适用于项目开发团队，包括产品经理、架构师、前后端开发工程师、测试工程师和DevOps工程师。

### 1.3 术语定义
| 术语 | 定义 |
|------|------|
| SAAS | Software as a Service，软件即服务 |
| API | Application Programming Interface，应用程序接口 |
| SLA | Service Level Agreement，服务级别协议 |

## 2. 系统概述

### 2.1 系统定位
在线加密文件解密SAAS平台是一个面向个人和企业的密码恢复服务，提供多种破解方案，用户可以通过Web界面上传加密文件，系统自动进行密码破解，并将结果通过邮件/站内消息通知用户。

### 2.2 核心功能
1. **用户管理**：注册登录、个人中心、会员管理
2. **文件上传**：支持拖拽、批量上传、断点续传
3. **破解任务**：任务提交、状态查询、结果查看
4. **支付管理**：订单生成、支付处理、退款管理
5. **通知服务**：邮件、短信、站内消息
6. **企业管理**：API接口、批量处理、白标方案
7. **监控告警**：系统监控、业务监控、安全监控

### 2.3 技术栈选型

#### 2.3.1 前端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Nuxt.js | 4.x | Vue.js SSR框架，SEO友好 |
| TypeScript | 5.x | 类型安全 |
| Tailwind CSS | 3.x | 原子化CSS框架 |
| shadcn-ui | latest | 高质量React组件库的Vue版本 |
| Pinia | latest | Vue状态管理 |
| VueUse | latest | Vue Composition API工具集 |
| VeeValidate | latest | 表单验证 |
| Axios | latest | HTTP客户端 |
| Socket.io-client | latest | WebSocket客户端 |
| Vue I18n | latest | 国际化 |

#### 2.3.2 后端技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| FastAPI | 0.104+ | 高性能Python Web框架 |
| Python | 3.10+ | 编程语言 |
| SQLAlchemy | 2.x | Python ORM |
| Alembic | latest | 数据库迁移工具 |
| Pydantic | 2.x | 数据验证 |
| Celery | 5.x | 分布式任务队列 |
| Redis | 7.x | 缓存和消息代理 |
| RabbitMQ | 3.12+ | 消息队列 |
| PostgreSQL | 15+ | 关系型数据库 |
| MinIO | latest | 对象存储 |
| Hashcat | 6.x+ | 密码破解工具 |
| ClamAV | latest | 病毒扫描 |

#### 2.3.3 DevOps技术栈
| 技术 | 版本 | 说明 |
|------|------|------|
| Docker | 24+ | 容器化 |
| Docker Compose | 2.x | 容器编排 |
| Nginx | 1.24+ | 反向代理和负载均衡 |
| GitHub Actions | latest | CI/CD |
| Prometheus | latest | 监控 |
| Grafana | latest | 可视化 |
| ELK Stack | latest | 日志管理 |

## 3. 系统架构设计

### 3.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                  用户层                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│  Web浏览器  │  移动浏览器  │  企业API客户端                                       │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │ HTTPS/WSS
┌─────────────────────────────────────────────────────────────────────────────┐
│                                 CDN层                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                        Cloudflare / 阿里云CDN                                │
│                     静态资源加速 + DDoS防护                                    │
└─────────────────────────────────────────────────────────────────────────────┘
                                        │
┌─────────────────────────────────────────────────────────────────────────────┐
│                               接入层                                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                              Nginx                                           │
│                      负载均衡 + SSL终止 + 限流                                 │
└─────────────────────────────────────────────────────────────────────────────┘
                    │                           │
        ┌───────────┴───────────┐   ┌───────────┴───────────┐
        │                       │   │                       │
┌───────┴────────┐      ┌───────┴────────┐      ┌─────────┴─────────┐
│   前端服务     │      │   后端API服务   │      │   WebSocket服务   │
│   (Nuxt.js)    │      │   (FastAPI)    │      │   (FastAPI)      │
│   静态资源+SSR  │      │   多实例部署    │      │   实时通信        │
└────────────────┘      └────────────────┘      └───────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
┌───────┴────────┐    ┌─────────┴─────────┐    ┌────────┴─────────┐
│  业务逻辑层     │    │   任务调度层      │    │   支付网关        │
├────────────────┤    ├──────────────────┤    ├─────────────────┤
│ • 用户管理     │    │   Celery         │    │ • 微信支付        │
│ • 文件处理     │    │   Beat           │    │ • 支付宝          │
│ • 任务管理     │    │                  │    │ • 信用卡          │
│ • 订单管理     │    │                  │    │                  │
└────────────────┘    └──────────────────┘    └──────────────────┘
        │                       │
        └───────────────────────┼───────────────────────┐
                                │                       │
        ┌───────────────────────┼───────────────────────┼───────────────┐
        │                       │                       │               │
┌───────┴────────┐    ┌─────────┴─────────┐    ┌────────┴─────────┐  ┌─────┴──────┐
│  数据访问层     │    │   文件存储层      │    │   缓存层          │  │  消息队列   │
├────────────────┤    ├──────────────────┤    ├─────────────────┤  ├────────────┤
│ PostgreSQL     │    │ MinIO/OSS        │    │ Redis            │  │ RabbitMQ    │
│ • 用户数据     │    │ • 上传文件       │    │ • 会话缓存        │  │ • 任务队列  │
│ • 任务数据     │    │ • 结果文件       │    │ • 热点数据        │  │ • 通知队列  │
│ • 订单数据     │    │                  │    │ • 分布式锁        │  │            │
└────────────────┘    └──────────────────┘    └──────────────────┘  └────────────┘
                                                                                                │
                                                                                    ┌───────────┴──────────┐
                                                                                    │   破解计算层          │
                                                                                    ├──────────────────────┤
                                                                                    │ Celery Worker        │
                                                                                    │ • Hashcat            │
                                                                                    │ • 自定义破解引擎      │
                                                                                    │ • GPU加速节点(可选)   │
                                                                                    └──────────────────────┘
```

### 3.2 分层架构说明

#### 3.2.1 用户层
- Web浏览器：桌面端用户访问
- 移动浏览器：移动端用户访问（响应式设计）
- 企业API客户端：企业用户通过API集成

#### 3.2.2 CDN层
- 静态资源加速（JS、CSS、图片）
- DDoS防护
- HTTPS卸载
- 全球加速

#### 3.2.3 接入层
- Nginx反向代理
- 负载均衡（轮询/最少连接）
- SSL/TLS终止
- 速率限制
- 请求路由

#### 3.2.4 应用层
- **前端服务**：Nuxt.js SSR渲染，提供页面和静态资源
- **后端API服务**：FastAPI RESTful API
- **WebSocket服务**：实时通信，任务进度推送

#### 3.2.5 业务逻辑层
- 用户管理、认证授权
- 文件处理、病毒扫描
- 任务管理、状态流转
- 订单管理、支付处理

#### 3.2.6 任务调度层
- Celery分布式任务队列
- Celery Beat定时任务
- 任务优先级管理
- 任务重试机制

#### 3.2.7 数据访问层
- PostgreSQL关系型数据库
- SQLAlchemy ORM
- 数据库连接池
- 读写分离

#### 3.2.8 文件存储层
- MinIO对象存储（开发/测试）
- 阿里云OSS（生产环境）
- 文件加密存储
- 自动清理过期文件

#### 3.2.9 缓存层
- Redis缓存
- 会话存储
- 热点数据缓存
- 分布式锁

#### 3.2.10 消息队列
- RabbitMQ消息 broker
- 任务队列
- 通知队列
- 延迟队列

#### 3.2.11 破解计算层
- Celery Worker
- Hashcat密码破解
- 自定义破解算法
- GPU加速节点（可选）

## 4. 系统模块划分

### 4.1 前端模块

```
frontend/
├── pages/                 # 页面
│   ├── index.vue         # 首页
│   ├── login.vue         # 登录页
│   ├── register.vue      # 注册页
│   ├── upload.vue        # 上传页
│   ├── tasks/            # 任务相关
│   │   ├── index.vue     # 任务列表
│   │   ├── [id].vue      # 任务详情
│   │   └── create.vue    # 创建任务
│   ├── files/            # 文件管理
│   │   ├── index.vue     # 文件列表
│   │   └── upload.vue    # 文件上传
│   ├── decrypt.vue       # 解密服务
│   ├── pricing.vue       # 价格页
│   ├── profile/          # 个人中心
│   │   ├── index.vue     # 个人信息
│   │   ├── security.vue  # 安全设置
│   │   └── billing.vue   # 账单管理
│   ├── settings/         # 系统设置
│   │   ├── index.vue     # 设置首页
│   │   ├── notifications.vue # 通知设置
│   │   └── api.vue       # API管理
│   └── docs/             # 帮助文档
│       ├── faq.vue       # FAQ
│       └── tutorial.vue  # 教程
├── components/           # 组件
│   ├── common/           # 通用组件
│   │   ├── Header.vue    # 头部导航
│   │   ├── Footer.vue    # 底部
│   │   ├── Sidebar.vue   # 侧边栏
│   │   └── Loading.vue   # 加载组件
│   ├── user/             # 用户相关
│   │   ├── LoginForm.vue # 登录表单
│   │   ├── RegisterForm.vue # 注册表单
│   │   └── UserProfile.vue # 用户资料
│   ├── file/             # 文件相关
│   │   ├── FileUpload.vue # 文件上传
│   │   ├── FileList.vue  # 文件列表
│   │   └── FileCard.vue  # 文件卡片
│   ├── task/             # 任务相关
│   │   ├── TaskCard.vue  # 任务卡片
│   │   ├── TaskList.vue  # 任务列表
│   │   ├── TaskStatus.vue # 任务状态
│   │   └── TaskProgress.vue # 任务进度
│   └── ui/               # UI组件
│       ├── Button.vue    # 按钮
│       ├── Input.vue     # 输入框
│       ├── Modal.vue     # 模态框
│       └── Table.vue     # 表格
├── composables/          # 组合式函数
│   ├── useAuth.ts        # 认证
│   ├── useApi.ts         # API调用
│   ├── useUpload.ts      # 文件上传
│   └── useWebSocket.ts   # WebSocket
├── stores/               # 状态管理
│   ├── user.ts           # 用户状态
│   ├── task.ts           # 任务状态
│   ├── file.ts           # 文件状态
│   └── ui.ts             # UI状态
├── utils/                # 工具函数
│   ├── request.ts        # HTTP请求
│   ├── validate.ts       # 验证函数
│   └── format.ts         # 格式化
├── types/                # 类型定义
│   ├── user.ts           # 用户类型
│   ├── task.ts           # 任务类型
│   └── file.ts           # 文件类型
└── middleware/           # 中间件
    ├── auth.ts           # 认证中间件
    └── logger.ts         # 日志中间件
```

### 4.2 后端模块

```
backend/
├── app/
│   ├── api/              # API路由
│   │   ├── v1/           # API v1版本
│   │   │   ├── auth.py   # 认证相关
│   │   │   ├── users.py  # 用户管理
│   │   │   ├── files.py  # 文件管理
│   │   │   ├── tasks.py  # 任务管理
│   │   │   ├── payments.py # 支付管理
│   │   │   └── webhooks.py # Webhook
│   │   └── deps.py       # 依赖注入
│   ├── core/             # 核心配置
│   │   ├── config.py     # 配置
│   │   ├── security.py   # 安全相关
│   │   ├── deps.py       # 全局依赖
│   │   └── logger.py     # 日志配置
│   ├── models/           # 数据模型
│   │   ├── user.py       # 用户模型
│   │   ├── file.py       # 文件模型
│   │   ├── task.py       # 任务模型
│   │   ├── payment.py    # 支付模型
│   │   └── base.py       # 基础模型
│   ├── schemas/          # Pydantic模式
│   │   ├── user.py       # 用户Schema
│   │   ├── file.py       # 文件Schema
│   │   ├── task.py       # 任务Schema
│   │   └── payment.py    # 支付Schema
│   ├── services/         # 业务逻辑
│   │   ├── auth_service.py    # 认证服务
│   │   ├── user_service.py    # 用户服务
│   │   ├── file_service.py    # 文件服务
│   │   ├── task_service.py    # 任务服务
│   │   ├── payment_service.py # 支付服务
│   │   ├── email_service.py   # 邮件服务
│   │   ├── sms_service.py     # 短信服务
│   │   ├── crack_service.py   # 破解服务
│   │   └── webhook_service.py # Webhook服务
│   ├── tasks/            # Celery任务
│   │   ├── crack_tasks.py     # 破解任务
│   │   ├── file_tasks.py      # 文件任务
│   │   ├── notification_tasks.py # 通知任务
│   │   └── cleanup_tasks.py   # 清理任务
│   ├── utils/            # 工具函数
│   │   ├── crypto.py     # 加密工具
│   │   ├── file.py       # 文件工具
│   │   ├── validator.py  # 验证工具
│   │   └── rate_limit.py # 限流工具
│   ├── middleware/       # 中间件
│   │   ├── auth.py       # 认证中间件
│   │   ├── cors.py       # CORS中间件
│   │   ├── rate_limit.py # 限流中间件
│   │   └── logger.py     # 日志中间件
│   ├── db/               # 数据库
│   │   ├── base.py       # 数据库基类
│   │   ├── session.py    # 数据库会话
│   │   └── init_db.py    # 初始化数据库
│   ├── storage/          # 存储服务
│   │   ├── base.py       # 存储基类
│   │   ├── minio.py      # MinIO实现
│   │   └── oss.py        # 阿里云OSS实现
│   ├── crack/            # 破解引擎
│   │   ├── base.py       # 破解引擎基类
│   │   ├── hashcat.py    # Hashcat封装
│   │   ├── dict_attack.py # 字典攻击
│   │   ├── brute_attack.py # 暴力破解
│   │   └── mask_attack.py # 掩码攻击
│   └── main.py           # 应用入口
├── tests/                # 测试
│   ├── api/              # API测试
│   ├── services/         # 服务测试
│   └── utils/            # 工具测试
├── scripts/              # 脚本
│   ├── init_db.py        # 初始化数据库
│   └── create_admin.py   # 创建管理员
├── alembic/              # 数据库迁移
│   └── versions/         # 迁移版本
├── requirements/         # 依赖文件
│   ├── base.txt          # 基础依赖
│   ├── dev.txt           # 开发依赖
│   └── prod.txt          # 生产依赖
├── pyproject.toml        # 项目配置
├── Dockerfile            # Docker镜像
└── docker-compose.yml    # Docker Compose配置
```

## 5. 接口设计原则

### 5.1 RESTful API设计

#### 5.1.1 URL设计规范
- 使用名词复数：`/api/v1/users`、`/api/v1/tasks`
- 层级关系：`/api/v1/users/{user_id}/tasks`
- 版本控制：通过URL路径版本 `/api/v1/`
- 小写字母，单词用连字符分隔：`/api/v1/task-status`

#### 5.1.2 HTTP方法使用
| 方法 | 说明 | 示例 |
|------|------|------|
| GET | 获取资源 | GET /api/v1/tasks |
| POST | 创建资源 | POST /api/v1/tasks |
| PUT | 完整更新资源 | PUT /api/v1/tasks/{id} |
| PATCH | 部分更新资源 | PATCH /api/v1/tasks/{id} |
| DELETE | 删除资源 | DELETE /api/v1/tasks/{id} |

#### 5.1.3 状态码规范
| 状态码 | 说明 | 使用场景 |
|--------|------|----------|
| 200 | OK | 请求成功 |
| 201 | Created | 资源创建成功 |
| 204 | No Content | 删除成功 |
| 400 | Bad Request | 请求参数错误 |
| 401 | Unauthorized | 未认证 |
| 403 | Forbidden | 无权限 |
| 404 | Not Found | 资源不存在 |
| 409 | Conflict | 资源冲突 |
| 422 | Unprocessable Entity | 参数验证失败 |
| 429 | Too Many Requests | 超过速率限制 |
| 500 | Internal Server Error | 服务器错误 |

#### 5.1.4 响应格式
```json
{
  "code": 0,
  "message": "success",
  "data": {},
  "timestamp": "2024-01-01T00:00:00Z"
}
```

错误响应格式：
```json
{
  "code": 1001,
  "message": "参数验证失败",
  "errors": {
    "email": "邮箱格式不正确"
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

### 5.2 WebSocket设计

#### 5.2.1 连接
```
wss://api.example.com/ws/tasks/{task_id}?token={jwt_token}
```

#### 5.2.2 消息格式
```json
{
  "event": "task.progress",
  "data": {
    "task_id": "uuid",
    "progress": 50,
    "status": "processing"
  },
  "timestamp": "2024-01-01T00:00:00Z"
}
```

#### 5.2.3 事件类型
| 事件 | 说明 |
|------|------|
| task.created | 任务创建 |
| task.started | 任务开始 |
| task.progress | 任务进度更新 |
| task.completed | 任务完成 |
| task.failed | 任务失败 |

## 6. 部署架构

### 6.1 开发环境

```yaml
services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - API_URL=http://localhost:8000

  backend:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/app
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=app
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

  rabbitmq:
    image: rabbitmq:3.12-management
    environment:
      - RABBITMQ_DEFAULT_USER=admin
      - RABBITMQ_DEFAULT_PASS=admin
    ports:
      - "5672:5672"
      - "15672:15672"

  minio:
    image: minio/minio
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=admin
      - MINIO_ROOT_PASSWORD=admin123
    volumes:
      - minio_data:/data

  celery_worker:
    build: ./backend
    command: celery -A app.tasks.celery_app worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/app
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://admin:admin@rabbitmq:5672
    depends_on:
      - backend
      - rabbitmq

  celery_beat:
    build: ./backend
    command: celery -A app.tasks.celery_app beat --loglevel=info
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/app
      - REDIS_URL=redis://redis:6379
      - RABBITMQ_URL=amqp://admin:admin@rabbitmq:5672
    depends_on:
      - backend
      - rabbitmq
```

### 6.2 生产环境

#### 6.2.1 服务器规划
| 服务 | 配置 | 数量 |
|------|------|------|
| Nginx | 4C8G | 2台 |
| 前端服务 | 4C8G | 2台 |
| 后端API | 8C16G | 3台 |
| PostgreSQL | 16C32G + SSD | 1主1从 |
| Redis | 8C16G | 哨兵模式 |
| RabbitMQ | 8C16G | 集群3节点 |
| Celery Worker | 16C32G | 5台（含GPU节点） |
| MinIO | 8C16G | 4节点分布式 |

#### 6.2.2 部署流程
1. 代码提交到Git仓库
2. GitHub Actions触发CI/CD
3. 运行测试、构建镜像
4. 推送镜像到镜像仓库
5. 更新Kubernetes部署
6. 健康检查、灰度发布

## 7. 安全设计

### 7.1 认证与授权
- JWT Token认证
- Refresh Token机制
- RBAC权限控制
- API Key认证（企业用户）

### 7.2 数据安全
- HTTPS加密传输（TLS 1.3）
- 密码bcrypt哈希（rounds=12）
- 敏感数据AES-256加密存储
- 数据库连接加密

### 7.3 防护措施
- API速率限制
- SQL注入防护
- XSS防护
- CSRF防护
- 文件病毒扫描
- DDoS防护

## 8. 监控与运维

### 8.1 监控指标
- 系统监控：CPU、内存、磁盘、网络
- 应用监控：请求量、响应时间、错误率
- 业务监控：任务量、成功率、转化率

### 8.2 日志管理
- 应用日志：30天
- 访问日志：90天
- 审计日志：180天
- ELK集中式日志管理

### 8.3 告警策略
- 紧急：服务宕口、数据泄露
- 重要：API错误率>5%
- 警告：资源使用>80%
- 提示：业务异常波动

## 9. 开发规范

### 9.1 代码规范
- Python：PEP 8
- TypeScript：ESLint + Prettier
- Git：Conventional Commits

### 9.2 测试规范
- 单元测试覆盖率>80%
- 接口测试必测
- 集成测试覆盖核心流程
- 性能测试压测

### 9.3 文档规范
- API文档：Swagger/OpenAPI
- 代码注释：docstring
- 部署文档：运维手册
- 变更日志：CHANGELOG.md

---

**文档版本：1.0**
**创建日期：2024-12-24**
**文档作者：架构师**
